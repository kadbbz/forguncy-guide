# ç¯å¢ƒå‡†å¤‡

æœ¬èŠ‚ä»‹ç»é›†ç¾¤èŠ‚ç‚¹çš„åŸºç¡€ç¯å¢ƒå‡†å¤‡å·¥ä½œæ“ä½œã€‚

> [!TIP]
> ğŸ¯ æ‰€æœ‰æ“ä½œé¢å‘é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹

## è®¾ç½®ä¸»æœºå

ä¸ºé›†ç¾¤èŠ‚ç‚¹è®¾ç½®ä¸»æœºåï¼Œç¡®ä¿å¯ä»¥é€šè¿‡ä¸»æœºåè¿›è¡Œé€šä¿¡ã€‚

å¯é€šè¿‡ `hostnamectl` å‘½ä»¤æŸ¥çœ‹å½“å‰ä¸»æœºåï¼Œå¦‚æœç¬¦åˆé¢„æœŸï¼Œå¯è·³è¿‡å½“å‰æ­¥éª¤ã€‚

```bash
# ç¼–è¾‘ hostnameæ–‡ä»¶
vim /etc/hostname
# å¡«å†™ä¸»æœºå
k8s-master
```

ä¸»æœºåä¿®æ”¹åè¯·é‡å¯ä¸»æœºï¼Œç¡®ä¿ä¸»æœºåç”Ÿæ•ˆã€‚

## hosts è§£æ

å°†éœ€è¦é€šä¿¡çš„æ‰€æœ‰èŠ‚ç‚¹é…ç½®åœ¨å„è‡ªçš„ hosts æ–‡ä»¶ä¸­ã€‚

```bash
echo -e "192.168.1.4 k8s-master\n192.168.1.5 k8s-worker\n" | sudo tee -a /etc/hosts
```

## å…³é—­é˜²ç«å¢™æœåŠ¡

1. å…³é—­é˜²ç«å¢™æœåŠ¡

    ```bash
    sudo ufw disable
    ```

    æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€

    ```bash
    sudo ufw disable
    ```

    è¾“å‡ºç»“æœç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼Œè¡¨æ˜å·²å…³é—­ï¼š

    ```bash
    Status: inactive
    ```

2. ç¦ç”¨é˜²ç«å¢™æœåŠ¡ï¼Œé˜²æ­¢ç³»ç»Ÿé‡å¯åè‡ªåŠ¨å¯åŠ¨

```bash
sudo systemctl stop ufw
sudo systemctl disable ufw
```

3. éªŒè¯é˜²ç«å¢™çŠ¶æ€

```bash
sudo systemctl status ufw
```

> [!TIP]
> å¦‚åæœŸéœ€è¦å¼€å¯é˜²ç«å¢™ï¼Œè¯·åœ¨å®‰è£…æˆåŠŸåå¼€å¯ï¼Œå¹¶å…¬å¼€ç›¸åº”çš„ç«¯å£

## æ°¸ä¹…å…³é—­ selinux

selinux è´Ÿè´£ Linux åœ¨ç³»ç»Ÿåº•å±‚èµ„æºè°ƒç”¨çš„å®‰å…¨ç®¡æ§ï¼Œåœ¨ä½¿ç”¨ Kubernetes æ—¶éœ€è¦å…³é—­ã€‚

Ubuntu é»˜è®¤ä¸å¯ç”¨ selinuxï¼Œå¯è·³è¿‡æ­¤æ­¥éª¤ã€‚

1. ç¼–è¾‘ SELinux é…ç½®æ–‡ä»¶

```bash
sudo vi /etc/selinux/config

# ä¿®æ”¹ SELINUX=enforcing ä¸º SELINUX=disabled
SELINUX=disabled
```

2. ä¿å­˜å¹¶é‡å¯ç³»ç»Ÿã€‚ç³»ç»Ÿé‡å¯æˆåŠŸåéªŒè¯ SELinux çŠ¶æ€ï¼š

```bash
sestatus
```

## å…³é—­ swap

swap ä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œå› æ­¤ Kubernetes å®˜æ–¹æ¨èå…³é—­ swapï¼Œå¦åˆ™åˆå§‹åŒ–æ§åˆ¶é¢æ¿æ—¶ä¼šå¼ºåˆ¶åœæ­¢ã€‚

åªéœ€æ‰“å¼€ `/etc/fstab`ï¼Œå°†å¦‚ä¸‹è¡Œç¦ç”¨å³å¯

```bash
#/swap.img none swap sw 0 0
```

å¯ä½¿ç”¨å‘½ä»¤ `free -h` æŸ¥çœ‹ã€‚å¦‚æœ swap éƒ½æ˜¯ 0 è¡¨æ˜ç³»ç»Ÿåœæ­¢ swapã€‚

## ç³»ç»Ÿæ—¶é—´åŒæ­¥

é›†ç¾¤æœåŠ¡éœ€è¦å¤šä¸ªèŠ‚ç‚¹çš„æ—¶é—´ä¿æŒä¸€è‡´ã€‚

å¯é€šè¿‡ `date` æˆ–è€… `timedatectl` å‘½ä»¤æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„æ—¶é—´ã€‚

å¦‚æœæ—¶é—´ä¸æ­£ç¡®ï¼Œè¯·æ›¿æ¢ä¸ºä¸œå…«åŒº-ä¸Šæµ·

```bash
timedatectl set-timezone Asia/Shanghai
```

## ç¡®è®¤ç½‘ç»œé€šä¿¡çš„æ¨¡å—å¼€å¯

```bash
modprobe overlay
modprobe br_netfilter
```

## é…ç½®æµé‡é“¾

æœ‰ä¸€äº› ipv4 çš„æµé‡ä¸èƒ½èµ° iptables é“¾ï¼Œå› ä¸º linux å†…æ ¸çš„ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œæ¯ä¸ªæµé‡éƒ½ä¼šç»è¿‡ä»–ï¼Œç„¶åå†åŒ¹é…æ˜¯å¦å¯è¿›å…¥å½“å‰åº”ç”¨è¿›ç¨‹å»å¤„ç†ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æµé‡ä¸¢å¤±ã€‚

1. é…ç½® k8s.conf æ–‡ä»¶ï¼ˆk8s.conf æ–‡ä»¶æœ¬èº«ä¸å­˜åœ¨ï¼Œéœ€è¦è‡ªå·±åˆ›å»ºçš„ï¼‰

```bash
sudo vim /etc/sysctl.d/k8s.conf

# æ–°å¢å¦‚ä¸‹å†…å®¹
vm.swappiness=0
net.bridge.bridge-nf-call-ip6tables=1
net.bridge.bridge-nf-call-iptables=1
net.ipv4.ip_forward=1
```

2. æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤é‡è½½ç³»ç»Ÿå‚æ•°

```bash
sudo sysctl --system
```

3. éªŒè¯ç»“æœ

```bash
# æ­¤å‘½ä»¤ç»“æœå¿…é¡»ä¸º 1
cat /proc/sys/net/ipv4/ip_forward
```
